<!--

    Copyright Â© 2020 ThingsBoard

-->
<md-dialog aria-label="Event dialog" class="tb-scheduler-event-dialog" style="width: 800px;">
    <form name="theForm" ng-submit="vm.save()">
        <md-toolbar>
            <div class="md-toolbar-tools">
                <h2 translate>{{vm.isAdd ? 'scheduler.create' : (vm.readonly ? 'scheduler.view' : 'scheduler.edit')}}</h2>
                <span flex></span>
                <md-button class="md-icon-button" ng-click="vm.cancel()">
                    <ng-md-icon icon="close" aria-label="{{ 'dialog.close' | translate }}"></ng-md-icon>
                </md-button>
            </div>
        </md-toolbar>
        <md-progress-linear class="md-warn" md-mode="indeterminate" ng-disabled="!$root.loading" ng-show="$root.loading"></md-progress-linear>
        <span style="min-height: 5px;" flex="" ng-show="!$root.loading"></span>
        <md-dialog-content>
            <div class="md-dialog-content">
                <md-content layout="column">
                    <md-tabs md-dynamic-height md-border-bottom>
                        <md-tab label="{{ 'scheduler.configuration' | translate }}">
                            <div layout="column" class="md-padding">
                                <tb-scheduler-event-type-autocomplete
                                        ng-model="vm.schedulerEvent.type"
                                        event-types="vm.configTypesList"
                                        the-form="theForm"
                                        ng-disabled="vm.readonly || $root.loading || vm.defaultEventType"
                                >
                                </tb-scheduler-event-type-autocomplete>
                                <tb-scheduler-event-config
                                        ng-if="vm.schedulerEvent.type"
                                        ng-model="vm.schedulerEvent.configuration"
                                        config-types="vm.configTypes"
                                        config-type="vm.schedulerEvent.type"
                                        ng-required="true"
                                        ng-readonly="vm.readonly || $root.loading"
                                >
                                </tb-scheduler-event-config>
                                <div ng-if="!vm.schedulerEvent.type" style="height: 30px;"></div>
                            </div>
                        </md-tab>
                        <md-tab label="{{ 'scheduler.schedule' | translate }}">
                            <fieldset ng-disabled="vm.readonly || $root.loading">
                                <div layout="column" style="padding-top: 15px;">
                                    <span style="height: 16px;"></span>
                                    <tb-timezone-select ng-disabled="vm.readonly || $root.loading" default-timezone="vm.defaultTimezone" ng-model="vm.schedulerEvent.schedule.timezone"></tb-timezone-select>
                                    <label translate class="tb-small">scheduler.start</label>
                                    <section layout="column" layout-gt-sm="row" layout-align-gt-sm="start start">
                                        <mdp-date-picker ng-required="true" ng-model="vm.startDate" mdp-placeholder="{{'scheduler.date' | translate}}">
                                        </mdp-date-picker>
                                        <mdp-time-picker ng-required="true" ng-model="vm.startDate" mdp-placeholder="{{'scheduler.time' | translate}}"
                                                         mdp-auto-switch="true"></mdp-time-picker>
                                    </section>
                                    <md-checkbox ng-disabled="vm.readonly || $root.loading" aria-label="{{'scheduler.repeat' | translate}}" ng-change="vm.repeatsChange()"
                                                 ng-model="vm.repeat">{{'scheduler.repeat' | translate}}
                                    </md-checkbox>
                                    <md-input-container ng-if="vm.repeat" class="md-block">
                                        <label translate>scheduler.repeats</label>
                                        <md-select ng-disabled="vm.readonly || $root.loading" name="repeatType" required aria-label="{{ 'scheduler.repeats' | translate }}"
                                                   ng-model="vm.schedulerEvent.schedule.repeat.type" ng-change="vm.repeatTypeChange()">
                                            <md-option ng-repeat="repeatType in vm.repeatType" ng-value="repeatType.value">
                                                {{ repeatType ? (repeatType.name | translate) : ''  }}
                                            </md-option>
                                        </md-select>
                                        <div ng-messages="vm.theForm.repeatType.$error">
                                            <div ng-message="required" translate>scheduler.repeats-required</div>
                                        </div>
                                    </md-input-container>
                                    <div layout="column" ng-if="vm.repeat && vm.schedulerEvent.schedule.repeat.type == vm.repeatType.timer.value">
                                        <label translate class="tb-small">scheduler.repeat-every</label>
                                        <span style="height: 16px;"></span>
                                        <div layout="column" layout-gt-sm="row">
                                            <md-input-container class="md-block" flex="50">
                                                <input required name="value" type="number" step="any" min="0" ng-model="vm.timerRepeat.repeatInterval">
                                                <div ng-messages="theForm.name.$error">
                                                    <div translate ng-message="required">scheduler.time-interval-required</div>
                                                </div>
                                            </md-input-container>
                                            <md-input-container class="md-block" flex="50">
                                                <md-select required name="timeUnit" ng-model="vm.timerRepeat.timeUnit">
                                                    <md-option ng-repeat="timeUnit in vm.timeUnits" ng-value="timeUnit.value">
                                                        {{ timeUnit.name | translate }}
                                                    </md-option>
                                                </md-select>
                                                <div ng-messages="theForm.name.$error">
                                                    <div translate ng-message="required">scheduler.time-unit-required</div>
                                                </div>
                                            </md-input-container>
                                        </div>
                                    </div>
                                    <div layout="column" ng-if="vm.repeat && vm.schedulerEvent.schedule.repeat.type == vm.repeatType.weekly.value">
                                        <label translate class="tb-small">scheduler.repeat-on</label>
                                        <span style="height: 16px;"></span>
                                        <div layout="column" layout-gt-sm="row">
                                            <div layout="row">
                                                <md-checkbox ng-disabled="vm.readonly || $root.loading" aria-label="{{'scheduler.repeat-on-sunday' | translate}}" ng-change="vm.weekDayChange()"
                                                             ng-model="vm.weeklyRepeat[0]">{{'scheduler.sunday-label' | translate}}
                                                    <md-tooltip md-direction="top">{{'scheduler.repeat-on-sunday' | translate}}</md-tooltip>
                                                </md-checkbox>
                                                <md-checkbox ng-disabled="vm.readonly || $root.loading" aria-label="{{'scheduler.repeat-on-monday' | translate}}" ng-change="vm.weekDayChange()"
                                                             ng-model="vm.weeklyRepeat[1]">{{'scheduler.monday-label' | translate}}
                                                    <md-tooltip md-direction="top">{{'scheduler.repeat-on-monday' | translate}}</md-tooltip>
                                                </md-checkbox>
                                                <md-checkbox ng-disabled="vm.readonly || $root.loading" aria-label="{{'scheduler.repeat-on-tuesday' | translate}}" ng-change="vm.weekDayChange()"
                                                             ng-model="vm.weeklyRepeat[2]">{{'scheduler.tuesday-label' | translate}}
                                                    <md-tooltip md-direction="top">{{'scheduler.repeat-on-tuesday' | translate}}</md-tooltip>
                                                </md-checkbox>
                                                <md-checkbox ng-disabled="vm.readonly || $root.loading" aria-label="{{'scheduler.repeat-on-wednesday' | translate}}" ng-change="vm.weekDayChange()"
                                                             ng-model="vm.weeklyRepeat[3]" style="margin-right: 16px;">{{'scheduler.wednesday-label' | translate}}
                                                    <md-tooltip md-direction="top">{{'scheduler.repeat-on-wednesday' | translate}}</md-tooltip>
                                                </md-checkbox>
                                            </div>
                                            <div layout="row">
                                                <md-checkbox ng-disabled="vm.readonly || $root.loading" aria-label="{{'scheduler.repeat-on-thursday' | translate}}" ng-change="vm.weekDayChange()"
                                                             ng-model="vm.weeklyRepeat[4]">{{'scheduler.thursday-label' | translate}}
                                                    <md-tooltip md-direction="top">{{'scheduler.repeat-on-thursday' | translate}}</md-tooltip>
                                                </md-checkbox>
                                                <md-checkbox ng-disabled="vm.readonly || $root.loading" aria-label="{{'scheduler.repeat-on-friday' | translate}}" ng-change="vm.weekDayChange()"
                                                             ng-model="vm.weeklyRepeat[5]">{{'scheduler.friday-label' | translate}}
                                                    <md-tooltip md-direction="top">{{'scheduler.repeat-on-friday' | translate}}</md-tooltip>
                                                </md-checkbox>
                                                <md-checkbox ng-disabled="vm.readonly || $root.loading" aria-label="{{'scheduler.repeat-on-saturday' | translate}}" ng-change="vm.weekDayChange()"
                                                             ng-model="vm.weeklyRepeat[6]">{{'scheduler.saturday-label' | translate}}
                                                    <md-tooltip md-direction="top">{{'scheduler.repeat-on-saturday' | translate}}</md-tooltip>
                                                </md-checkbox>
                                            </div>
                                        </div>
                                    </div>
                                    <mdp-date-picker ng-if="vm.repeat" ng-required="true" ng-model="vm.endsOn" mdp-placeholder="{{'scheduler.ends-on' | translate}}">
                                    </mdp-date-picker>
                                </div>
                            </fieldset>
                        </md-tab>
                    </md-tabs>
                </md-content>
            </div>
        </md-dialog-content>
        <md-dialog-actions layout="row">
            <span flex></span>
            <md-button ng-if="!vm.readonly" ng-disabled="$root.loading || theForm.$invalid || !theForm.$dirty" type="submit" class="md-raised md-primary">
                {{ (vm.isAdd ? 'action.create' : 'action.save') | translate }}
            </md-button>
            <md-button ng-disabled="$root.loading" ng-click="vm.cancel()" style="margin-right:20px;">{{ (vm.readonly ? 'action.close' : 'action.cancel') | translate }}</md-button>
        </md-dialog-actions>
    </form>
</md-dialog>
